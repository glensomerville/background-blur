!function(t){"use strict";function i(i){return this.each(function(){var e=t(this),o=e.data("plugin.backgroundBlur"),n=t.extend({},r.DEFAULTS,e.data(),"object"==typeof i&&i);o||e.data("plugin.backgroundBlur",o=new r(this,n)),"fadeIn"===i?o.fadeIn():"fadeOut"===i?o.fadeOut():"string"==typeof i&&o.generateBlurredImage(i)})}var e=function(){for(var t,i=3,e=document.createElement("div"),o=e.getElementsByTagName("i");e.innerHTML="<!--[if gt IE "+ ++i+"]><i></i><![endif]-->",o[0];);return i>4?i:t}(),o=function(){return"_"+Math.random().toString(36).substr(2,9)},n={svgns:"http://www.w3.org/2000/svg",xlink:"http://www.w3.org/1999/xlink",createElement:function(t,i){var e=document.createElementNS(n.svgns,t);return i&&n.setAttr(e,i),e},setAttr:function(t,i){for(var e in i)"href"===e?t.setAttributeNS(n.xlink,e,i[e]):t.setAttribute(e,i[e]);return t}},r=function(i,e){this.internalID=o(),this.$element=t(i),this.$width=this.$element.width(),this.$height=this.$element.height(),this.element=i,this.options=t.extend({},r.DEFAULTS,e),this.$overlayEl=this.createOverlay(),this.$blurredImage={},this.useVelocity=this.detectVelocity(),this.attachListeners(),this.generateBlurredImage(this.options.imageURL)};r.VERSION="0.0.1",r.DEFAULTS={imageURL:"",blurAmount:10,imageClass:"",overlayClass:"",duration:!1,opacity:1,imageAspectRatio:"none"},r.prototype.detectVelocity=function(){return!!window.jQuery.Velocity},r.prototype.attachListeners=function(){this.$element.on("ui.blur.loaded",t.proxy(this.fadeIn,this)),this.$element.on("ui.blur.unload",t.proxy(this.fadeOut,this))},r.prototype.fadeIn=function(){this.options.duration&&this.options.duration>0&&(this.useVelocity?this.$blurredImage.velocity({opacity:this.options.opacity},{duration:this.options.duration}):this.$blurredImage.animate({opacity:this.options.opacity},{duration:this.options.duration}))},r.prototype.fadeOut=function(){this.options.duration&&this.options.duration>0?this.useVelocity?this.$blurredImage.velocity({opacity:0},{duration:this.options.duration}):this.$blurredImage.animate({opacity:0},{duration:this.options.duration}):this.$blurredImage.css({opacity:0})},r.prototype.generateBlurredImage=function(t){var i=this.$blurredImage;this.internalID=o(),i.length>0&&(this.options.duration&&this.options.duration>0?this.useVelocity?i.first().velocity({opacity:0},{duration:this.options.duration,complete:function(){i.remove()}}):i.first().animate({opacity:0},{duration:this.options.duration,complete:function(){i.remove()}}):i.remove()),e?this.$blurredImage=this.createIMG(t,this.$width,this.$height):this.$blurredImage=this.createSVG(t,this.$width,this.$height)},r.prototype.createOverlay=function(){return this.options.overlayClass&&""!==this.options.overlayClass?t("<div></div>").prependTo(this.$element).addClass(this.options.overlayClass):!1},r.prototype.createSVG=function(i,e,o){var r=this,s=n.createElement("svg",{xmlns:n.svgns,version:"1.1",width:e,height:o,id:"blurred"+this.internalID,"class":this.options.imageClass,viewBox:"0 0 "+e+" "+o,preserveAspectRatio:"none"}),a="blur"+this.internalID,u=n.createElement("filter",{id:a}),l=n.createElement("feGaussianBlur",{"in":"SourceGraphic",stdDeviation:this.options.blurAmount}),h=n.createElement("image",{x:0,y:0,width:e,height:o,externalResourcesRequired:"true",href:i,style:"filter:url(#"+a+")",preserveAspectRatio:this.options.imageAspectRatio});h.addEventListener("load",function(){r.$element.trigger("ui.blur.loaded")},!0),h.addEventListener("SVGLoad",function(){r.$element.trigger("ui.blur.loaded")},!0),u.appendChild(l),s.appendChild(u),s.appendChild(h);var d=t(s);return r.options.duration&&r.options.duration>0&&(d.css({opacity:0}),window.setTimeout(function(){"0"===d.css("opacity")&&d.css({opacity:1})},this.options.duration+100)),this.element.insertBefore(s,this.element.firstChild),d},r.prototype.createIMG=function(t,i,e){var o=this,n=this.prependImage(t),r=2*this.options.blurAmount>100?100:2*this.options.blurAmount;return n.css({filter:"progid:DXImageTransform.Microsoft.Blur(pixelradius="+r+") ",top:2.5*-this.options.blurAmount,left:2.5*-this.options.blurAmount,width:i+2.5*this.options.blurAmount,height:e+2.5*this.options.blurAmount}).attr("id","blurred"+this.internalID),n.load(function(){o.$element.trigger("ui.blur.loaded")}),this.options.duration&&this.options.duration>0&&window.setTimeout(function(){"0"===n.css("opacity")&&n.css({opacity:1})},this.options.duration+100),n},r.prototype.prependImage=function(i){var e,o=t('<img src="'+i+'" />');return e=this.$overlayEl?o.insertBefore(this.$overlayEl).attr("id",this.internalID).addClass(this.options.imageClass):o.prependTo(this.$element).attr("id",this.internalID).addClass(this.options.imageClass)};var s=t.fn.backgroundBlur;t.fn.backgroundBlur=i,t.fn.backgroundBlur.Constructor=r,t.fn.backgroundBlur.noConflict=function(){return t.fn.backgroundBlur=s,this}}(jQuery);